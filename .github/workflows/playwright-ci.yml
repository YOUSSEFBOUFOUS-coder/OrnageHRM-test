name: Playwright Tests Optimized

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout du code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Installer Python
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      # 3️⃣ Installer dépendances (pytest + Playwright)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          # Installer uniquement Chromium (le plus rapide pour les tests)
          playwright install chromium

      # 3.5️⃣ Créer dossiers pour vidéos et traces
      - name: Create folders
        run: mkdir -p videos traces

      # 4️⃣ Lancer les tests
      - name: Run Playwright tests
        run: pytest --maxfail=1 --disable-warnings -q

      # 5️⃣ Upload des vidéos et traces
      - name: Upload videos and traces
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-results
          path: |
            videos/
            traces/
